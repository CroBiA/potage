<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<!-- 
  Copyright 2016 University of Adelaide.
 
  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at
 
       http://www.apache.org/licenses/LICENSE-2.0
 
  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui" xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

    <f:view contentType="text/html">        
        <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
        <h:head>
            <h:outputStylesheet  library="css" name="css1.css"/>
            <link rel="shortcut icon" type="image/x-icon" href="images/favicon1.ico"/>

            <f:facet name="first">
                <meta content='text/html; charset=UTF-8' http-equiv="Content-Type"/>
                <title>POTAGE - Popseq Ordered Triticum Aestivum Gene Expression</title>
            </f:facet>


            <p:idleMonitor timeout="3600000" >
                <p:ajax event="idle" listener="#{loginController.timeout()}"/>
            </p:idleMonitor>
        </h:head>
        <h:outputStylesheet  library="css" name="css4.css"/>
        <body  onresize="updatechartpanel">



        <h:outputLabel  value="#{counterBean.recordStats}"/>





        <h:form id="formMenu"  >                
            <p:dock  id="dock" model="#{mainBean.menuModelSimple}" position="top" itemWidth="38" maxWidth="65" proximity="80"     />                          
        </h:form>






        <!--        <p:dialog modal="true" widgetVar="blockUI" draggable="false" closable="false" resizable="false" showHeader="false" 
                          showEffect="#{effectsBean.effectType}" hideEffect="#{effectsBean.effectType}">
                    <p:ajax update="@this" process="@this" />
                    <p:graphicImage value="/images/ajax-loader#{randomBean.getRandom(13)}.gif" />  
                </p:dialog> -->
        <p:dialog modal="true" widgetVar="blockUI" draggable="false" closable="false" resizable="false" showHeader="false" >
            <p:ajax update="@this" process="@this" />
            <p:graphicImage value="/images/ajax-loader#{randomBean.getRandom(13)}.gif" />  
        </p:dialog> 
        <p:dialog id="blockBLAST" modal="true" widgetVar="blockBLAST" draggable="false" closable="false" resizable="false" showHeader="false" style="text-align: center" >
            <p:ajax update="@this" process="@this" />
            <p:graphicImage value="/images/ajax-loader#{randomBean.getRandom(13)}.gif" />
            <br/>
            <h:outputText value="BLASTn search running..."  style="font-size: larger"/>
            <br/>
            <h:outputText value="once finished, results will be displayed and will also become available at " />
            <br/>
            <h:outputText id="linkBLAST" value=" #{mainBean.blastn.getResultsLink('peru')}" escape="false"/>
        </p:dialog> 

        <p:growl id="growl" showDetail="true" life="20000" escape="false" /> 


        <p:spacer width="100%" height="40"  />



        <h:form id="helpForm">
            <p:panel id="helpPanel" widgetVar="helpPanel" collapsed="true" toggleable="true" toggleSpeed="250" >
                <f:facet name="header">                    
                    <!--                    <p:commandLink  onclick="PF('helpPanel').toggle();"  style="text-align: center">                            
                                            <p:graphicImage value="/images/help1.png" height="20px" alt="Help" />      
                                            <h:outputText value="Help"  />
                                        </p:commandLink>-->
                    <p:commandButton  onclick="PF('helpPanel').toggle();" icon="img-button-help" title="Help" label="Help" value="Help"/>
                </f:facet>
                <p:accordionPanel activeIndex="">
                    <p:tab title="About POTAGE and the underlying data" >
                        Popseq Ordered Triticum Aestivum Gene Expression (POTAGE, pronounced "<a href="http://img2.tfd.com/pron/mp3/en/UK/df/dfskskssdfd5drh7.mp3" target="_blank">pəʊˈtɑːʒ</a>")
                        is a web application which integrates map location information with gene expression 
                        and inferred functional annotation.

                        <h4> The functionality of POTAGE depends on several datasets: </h4>
                        <p:accordionPanel activeIndex="">
                            <p:tab title="IWGSC Chromosome Survey Sequences">
                                <ul> 
                                    <li>Consist of individual assemblies of flow-sorted chromosome arms (apart from chromosome 3B assembled as a whole) </li>
                                    <li>Described in <a href="http://www.sciencemag.org/content/345/6194/1251788.abstract" target="_blank">A chromosome-based draft sequence of the hexaploid bread wheat (Triticum aestivum) genome, Science 18 July 2014, Vol. 345 no. 6194</a> </li>
                                    <li>Since cited in <a href="https://www.wheatgenome.org/Projects/IWGSC-Bread-Wheat-Projects/Sequencing/IWGSC-Chromosome-Survey-Sequencing/Citations" target="_blank"> numerous publications </a> </li>
                                </ul>
                            </p:tab>
                            <p:tab title="POPSEQ map of Chromososme Survey Sequences">
                                <ul> 
                                    <li> Utilizes whole genome sequencing for genotyping to establish maker order from sequencing data </li>
                                    <li> 
                                        Provides the genetic anchoring of the IWGSC survey sequences by population sequencing. For more details, see <a href="http://onlinelibrary.wiley.com/doi/10.1111/tpj.12319/abstract" target="_blank">Anchoring and ordering NGS contig assemblies by population sequencing (POPSEQ), Plant J. 76(4) 718-727</a>  
                                    </li>
                                    <li>
                                        Please note that: 
                                    </li>
                                    <ul>
                                        <li>Number of contigs per cM interval is dependent on recombination frequency </li>
                                        <li>The resolution of a genetic map is dependent on the population size</li>
                                    </ul>
                                </ul>
                            </p:tab>
                            <p:tab title="High Confidence (HC) wheat gene predictions (a.k.a MIPS gene predictions)">
                                <ul> 
                                    <li>
                                        Described in <a href="http://www.sciencemag.org/content/345/6194/1251788.abstract" target="_blank">A chromosome-based draft sequence of the hexaploid bread wheat (Triticum aestivum) genome, Science 18 July 2014, Vol. 345 no. 6194</a>
                                    </li>
                                    <li>
                                        POTAGE utilizes <a href="ftp://ftpmips.helmholtz-muenchen.de/plants/wheat/IWGSC/genePrediction_v2.1/" target="_blank">version 2.1 </a> 
                                    </li>
                                </ul>
                            </p:tab>
                            <p:tab title="Functional annotation">
                                <ol> 
                                    <li>MIPS annotation provided with the HC predictions</li>
                                    <li>Rice-derived annotation, obtained by</li>                
                                    <ul>
                                        <li>
                                            Aligning HC coding sequences to rice proteins from <a href="http://rapdb.dna.arc.go.jp" target="_blank">International Rice Genome Sequencing Project (2005), </a> 
                                            <a href="http://www.nature.com/nature/journal/v436/n7052/abs/nature03895.html" target="_blank">The map-based sequence of the rice genome. Nature 436: 793–800</a>
                                        </li>
                                        <li>Annotation retrieved from top rice hits if available and if alignment quality thresholds were met.</li>
                                    </ul>
                                </ol>                                                
                            </p:tab>
                            <p:tab title="RNA-Seq data">
                                The primary RNA-Seq dataset included in the public release of POTAGE is the  
                                <a href="http://wheat-urgi.versailles.inra.fr/Seq-Repository/RNA-Seq" target="_blank"> Chinese Spring tissue series dataset; </a>
                                <br/>

                                Non-oriented library (TruSeq, Illumina) sequenced on Illumina HiSeq2000 2x100bp (PE) for 15 different conditions corresponding to five wheat organs (root, leaf, stem, spike, grain) at three developmental stages each in 2 duplicates
                                <font style="font-family: monospace">
                                    <table>
                                        <tr><td></td></tr>
                                        <tr><td>Stage</td><td>Wheat growth stage</td><td>Feekes scale</td><td>Zadoks scale</td><td>Leaves</td><td>Root</td><td>Stem</td><td>Spike</td><td>Grain</td></tr>
                                        <tr><td>Seedling</td><td>First leaf through coleoptile</td><td>1</td><td>10</td><td>x</td><td>x</td><td></td><td></td><td></td></tr>
                                        <tr><td>Three leaves</td><td>3 leaves unfolded</td><td></td><td>13</td><td></td><td>x</td><td></td><td></td><td></td></tr>
                                        <tr><td>Three tillers</td><td>Main shoot and 3 tillers</td><td></td><td>23</td><td>x</td><td></td><td></td><td></td><td></td></tr>
                                        <tr><td>Spike at 1 cm</td><td>Pseudostem erection</td><td>5</td><td>30</td><td></td><td></td><td>x</td><td></td><td></td></tr>
                                        <tr><td>Two nodes</td><td>2nd detectable node</td><td>7</td><td>32</td><td></td><td></td><td>x</td><td>x</td><td></td></tr>
                                        <tr><td>Meiosis</td><td>Flag leaf ligule and collar visible</td><td>9</td><td>39</td><td></td><td>x</td><td></td><td>x</td><td></td></tr>
                                        <tr><td>Anthesis</td><td>1/2 of flowering complete</td><td></td><td>65</td><td></td><td></td><td>x</td><td>x</td><td></td></tr>
                                        <tr><td>2 DAAs</td></tr>
                                        <tr><td>(50°C.days)"</td><td>Kernel (caryopsis) watery ripe</td><td></td><td>71</td><td>x</td><td></td><td></td><td></td><td>x</td></tr>
                                        <tr><td>14 DAAs</td></tr>
                                        <tr><td>(350°C.days)"</td><td>Medium Milk</td><td></td><td>75</td><td></td><td></td><td></td><td></td><td>x</td></tr>
                                        <tr><td>30 DAAs</td></tr>
                                        <tr><td>(700°C.days)"</td><td>Soft dough</td><td></td><td>85</td><td></td><td></td><td></td><td></td><td>x</td></tr>
                                        <tr><td></td></tr>
                                    </table>
                                </font>
                                The computation of the expression values for the main Chinese Spring dataset available in POTAGE is described in
                                <a href="http://jxb.oxfordjournals.org/content/67/9/2847.full" target="_blank">this paper</a>. The relevant paragraph is included below:<br/>                                
                                To obtain gene expression information for genes located in the QTL region we used the PopSeq map for bread wheat 
                                together with the high confidence (HC) gene predictions described in IWGSC (2014) and the publicly available 
                                <a href="http://wheat-urgi.versailles.inra.fr/Seq-Repository/RNA-Seq" target="_blank">RNA-Seq data for cv. Chinese Spring</a>. 
                                This dataset covers five different organs (root, leaf, stem, spike, grain) at three developmental stages, each in two replicates. 
                                We used the HC gene predictions, <a href="ftp://ftpmips.helmholtz-muenchen.de/plants/wheat/IWGSC/genePrediction_v2.1/" target="_blank">version 2.1</a>  
                                as reference for mapping the RNA-Seq reads. The reference was prepared by extracting the genomic sequence for each of the predicted genes 
                                with up to 2kb upstream and downstream bases whenever available from the corresponding IWGSC-CSS contig. 
                                The coordinates in the corresponding GTF/GFF transcript annotations file were adjusted accordingly. 
                                RNA-Seq reads were quality-, adapter- and length-trimmed using Trimmomatic (Bolger et al., 2014), version 0.30, 
                                with a custom list of adapter sequences and the following settings: ‘ILLUMINACLIP:adapters.fa:1:6:6 LEADING:3 TRAILING:3 SLIDINGWINDOW:4:6 MINLEN:60’. 
                                After indexing the reference using Bowtie2 (Langmead and Salzberg, 2012) version 2.2.1, 
                                trimmed reads were aligned to the reference using TopHat (Kim et al., 2013) version 2.2.1, not allowing any mismatches or indels. 
                                Paired reads were required to map concordantly (--no-discordant setting) to the same (--no-mixed setting) reference sequence. 
                                BAM files for the biological replicates were merged, apart from a single tissue/stage sample (spike_Z39) where only one sample was available. 
                                Expression was quantified by Cufflinks (Roberts et al., 2011) version 2.1.1 utilizing (through the --GTF option) 
                                the adjusted version of the reference transcript annotations provided with the HC gene predictions. 
                                The remaining settings were left at their defaults, except for: --max-multiread-fraction 1, --frag-len-std-dev 50 --max-intron-length 5 000. 
                                FPKMs (fragments per kilobase of exon per million fragments mapped) per gene (rather than per isoform) were extracted and aggregated in tabular form. 
                            </p:tab>
                        </p:accordionPanel>
                        <h4> POTAGE was last updated in June 2017 </h4>
                    </p:tab>
                    <p:tab title="Words of caution">
                        <ul> 
                            <li>The expression values are computed per MIPS gene prediction and to a large extent rely on the correctness of the predictions. Some gene predictions are partial due to the underlying assemblies being highly fragmented.</li>
                            <li>Occasionally, two separate genes may fall under one Traes ID and in such cases the associated annotation and expression values may be quite misleading. </li>
                            <li>POPSEQ map does not anchor all the gene-carrying contigs, also note that </li>
                            <ul> 
                                <li>Number of contigs/cM interval dependent on recombination frequency</li>
                                <li>The resolution of a genetic map is dependent on the population size</li>
                            </ul>
                            <p:graphicImage value="/images/help/PopSeq_resolution_3A.png" width="800px"  /> 
                        </ul>
                    </p:tab> 
                    <p:tab title="Helpsheet 1 - Finding genes by gene ID, contig ID ">
                        <ol> 
                            <li>
                                Click on "Search by identifier" icon in the dock-menu at the top of the page
                                <br />
                            <p:commandLink onclick="PF('searchDialog').show()">
                                <p:graphicImage value="/images/search5.png"  /> 
                            </p:commandLink>                
                            </li>
                            <li>Paste or type in your identifier, POTAGE recognizes two types of identifiers
                                <ol> 
                                    <li>
                                        MIPS HCS gene predictions' identifiers, e.g. 
                                    <p:commandLink update=":formSearch:idInput" actionListener="#{mainBean.setUserQuery('Traes_2AS_C3EF3A27F')}"  oncomplete="PF('searchDialog').show()">
                                        <h:outputText value="Traes_2AS_C3EF3A27F" />
                                    </p:commandLink>                            
                            </li>                                                
                            <li>
                                IWGSC CSS identifiers, e.g. 
                            <p:commandLink update=":formSearch:idInput" actionListener="#{mainBean.setUserQuery('5BS_1598873')}" oncomplete="PF('searchDialog').show()">
                                <h:outputText value="5BS_1598873" />
                            </p:commandLink>
                            </li>
                        </ol>
                        </li>
                        <li>Click 'Search' </li>
                        If found, your gene/contig will be highlighted in one of the two available output tables. 
                        Otherwise an appropriate message will be displayed.
                        <br />
                        Please note that if a CSS contig carries more than one HCS gene prediction it will be present in the 
                        the main output table multiple times on consecutive positions. 
                        <br />                        
                        Consequently, if the gene/contig is the last one 
                        on a page it is best to check the next page as it may contain another gene on the same contig (also highlighted).
                        <br />
                        <p:graphicImage value="/images/help/highlighted.png"  /> 

                        </ol>
                    </p:tab>
                    <p:tab title="Helpsheet 2 - Finding genes by sequence alignment (BLASTn)">
                        <ol> 
                            <li>
                                Click on "Search by sequence" icon in the dock-menu at the top of the page
                                <br />
                            <p:commandLink onclick="PF('searchSeqPanel').show()">
                                <p:graphicImage value="/images/searchATGC.png"  /> 
                            </p:commandLink>                
                            </li>
                            <li>Upload a FASTA file or paste one or more sequences in FASTA format 
                                <br />
                            <p:graphicImage value="/images/help/seqsearch_input.png"  />                                 
                            <br />
                            </li>                                                
                            <li>Once the job has finished you will be redirected to  </li>
                            <ul>
                                <li>"Results - per query" tab if you submitted one sequence (skip to 5) </li>
                                <li>"Results - summary" tab if you submitted more than one sequence</li>
                            </ul>
                            <li>In the former case, selecting one of the sequences takes you to the results for that particular query </li>
                            <br />
                            <p:graphicImage value="/images/help/seqsearch_results-summary.png"  />                                 
                            <li>In the "Results - per query" tab each row in the table represents a hit</li>
                            <br />
                            <p:graphicImage value="/images/help/seqsearch_results-per-query.png"  />                                 
                            <br />
                            <li>When a row (hit) is selected, POTAGE tries to locate the underlying contig. 
                                If found, the contig will be highlighted in one of the two available output tables.  
                                Otherwise an appropriate message will be displayed.
                                <br />
                                <br />
                            <p:graphicImage value="/images/help/seqsearch_results-in-table.png"  />                                 
                            <br />
                            If, as in this case, the contig holds more than one gene 
                            you can identify the correct gene by comparing the coordinates of your hit in "Results - per query" table 
                            with "From" and "To" coordinates of the gene on that contig in the main table.
                            <br />
                            Please note that if a CSS contig carries more than one HCS gene prediction it will be present in the 
                            the main output table multiple times on consecutive positions. 
                            Consequently, if the gene/contig is the last one 
                            on a page it is best to investigate the next page as it may contain another gene on the same contig (also highlighted).
                            <br />
                            </li>
                        </ol>

                    </p:tab>
                    <p:tab title="Helpsheet 3 - Identifying candidate genes within a cM range on a chromosome">
                        <ol> 
                            <li> Select your chromosome of interest form the dock-menu at the top of the page
                                <br/>
                            <p:commandLink actionListener="#{mainBean.onSelect('2B')}" update=":formCentre:dataTable,:formCentre:chartsGrid"
                                           onstart="PF('blockUI').show()" oncomplete="PF('blockUI').hide();">
                                <p:graphicImage value="/images/help/select_2B.png"  /> 
                            </p:commandLink>                                            
                            <br/>
                            This will populate the main table below, listing HCS gene predictions identified on this chromosome.
                            <br/>
                            </li>
                            <li>Next, set appropriate cM range at the top of the main table 
                                <br/>
                            <p:commandLink actionListener="#{mainBean.cMLoadExample('2B', 15.931, 15.931)}" 
                                           update=":formCentre:dataTable"
                                           onstart="PF('blockUI').show()" oncomplete="PF('dataTable').filter();PF('blockUI').hide();">
                                <p:graphicImage value="/images/help/select_cM.png"  />                                                                                                 
                            </p:commandLink>                             
                            <br/>
                            </li>
                            <li>Depending on the number of gene predictions present in the selected range, you may be able to browse through their 
                                expression profiles by using one of the buttons present for each gene in the "Expression" column of the main table. 
                                <ul>
                                    <li>View displays expression chart(s) in a dialog box. </li>
                                    <li><p:button icon="ui-icon-arrowthickstop-1-s" disabled="true" />
                                    Adds the expression chart(s) to the  "Expression charts display" panel
                            </li>
                            <li><p:button icon="ui-icon-extlink" disabled="true" />
                            Redirects you to view the expression values for the relevant gene on on <a href="http://wheat.pw.usda.gov/WheatExp/" target="_blank">WheatExp: An Expression Database for Polyploid Wheat </a>
                            </li>                                                                    
                            </ul>
                            You can also select one or more genes and collectively add those to the "Expression charts display" by clicking 
                            <p:button value="Add to charts display"  icon="ui-icon-arrowthickstop-1-s" title="Add gene to expression charts display" disabled="true" /> in the bottom left corner of the main table 
                            <br/>
                            <p:graphicImage value="/images/help/display_2B.png"  /> 
                            </li>
                        </ol>                        

                        <br />


                    </p:tab>                    

                    <p:tab title="Helpsheet 4 - Rules of thumb for interpreting expression values">                                        
                        <h:outputText value="Various limitations of the underlying datasets and the methods used mean that 
                                      the expression values available in POTAGE should be treated with caution. 
                                      Here are some examples of how different FPKM values could be interpreted." />
                        <p:spacer height="10"/>
                        <p:tabView style="width: 600px" >
                            <p:tab title="low">
                                <p:graphicImage value="/images/help/low_abundant.png"  /> 
                                <br/>
                                <h4> Low abundant transcript (Myb TF) </h4>                            
                            </p:tab>
                            <p:tab title="medium">
                                <p:graphicImage value="/images/help/medium_abundant.png" /> 
                                <br/>
                                <h4> Medium abundant transcript (Thioredoxin h)</h4>                            
                            </p:tab>
                            <p:tab title="high">
                                <p:graphicImage value="/images/help/very_abundant.png" /> 
                                <br/>
                                <h4>Very abundant transcript (Rubisco small chain)</h4>                            
                            </p:tab>
                        </p:tabView>
                    </p:tab>
                    <p:tab title="Frequently Asked Questions (FAQ)">
                        <dl> 
                            <dt>Why is a gene displayed on chromosome 3A even though the identifier indicates it comes from chromosome 1AL?</dt>
                            <dd>Both the chromosome survey sequences (CSS) and POPSEQ can allocate a gene/contig incorrectly, 
                                for consistency we rely on POPSEQ's allocation of contigs to chromosomes wherever such information is available,
                                in the remaining cases we fall back to CSS identifiers.</dd>

                            <dt>Why is my contig/gene of interest lacking a cM value in the main table?</dt>
                            <dd>POPSEQ map does not capture all of the CSS contigs, 
                                in fact only about half of contigs for which HC gene predictions are available have been anchored. 
                                These genes are appended to the end of the table for their respective chromosome.</dd>
                            <dt>How were the expression values generated?</dt>
                            <dd>The computation of the expression values for the main Chinese Spring dataset available in POTAGE is described in
                                <a href="http://jxb.oxfordjournals.org/content/67/9/2847.full" target="_blank">this paper</a>
                                starting from the second sentence under "Gene identification and RNA-Seq data" subsection.</dd>
                            <dt>Can I run POTAGE locally on my own hardware?</dt>
                            <dd>Yes, we have developed POTAGE with this in mind. By far the easiest way to do
                                this is to use our Docker image (<a href="https://hub.docker.com/r/crobiad/potage" target="_blank">crobiad/potage</a>).
                                To get started, you will first need to install the "<a href="https://docs.docker.com/engine/installation/" target="_blank">Docker Engine</a>". Once this is installed, simply follow the <a href="https://github.com/CroBiA/docker-potage/blob/master/README.md#quick-start" target="_blank">Quick Start</a> instructions.</dd>
                        </dl>
                    </p:tab>

                    <p:tab title="Contact Us">
                        You can contact us in a variety of ways:
                        <ul>
                            <li>For bug reports and feature requests, submit a <a href="https://github.com/CroBiAd/potage/issues/new" target="_blank">new issue</a> on GitHub</li>
                            <li>For other things, contact the main POTAGE developer: <a href="mailto:radoslaw.suchecki@adelaide.edu.au?Subject=POTAGE" target="_top">Rad Suchecki</a> </li>
                        </ul>
                    </p:tab>

                </p:accordionPanel>
            </p:panel>
            <!--</p:dialog>-->
        </h:form>

        <p:spacer id="dummyForOverlay" width="100%" height="20"  />

        <p:dialog  id="searchDialog" header="Search for sequence on all chromosomes (by ID)" widgetVar="searchDialog" modal="false" position="left+25%,top+25%" 
                   showEffect="scale" hideEffect="fade"  draggable="true" closable="true"  resizable="false" closeOnEscape="true" width="650" height="160">
            <h:form id="formSearch">
                <p:toolbar >                        
                    <f:facet name="left">
                        <p:inputText id="idInput" widgetVar="idInput" style="width:240px" placeholder="Enter IWGSC SS identifier or a MIPS gene ID" 
                                     value="#{mainBean.userQuery}"  />
                        <p:spacer height="0" width="10" />
                        <p:commandLink update="idInput" actionListener="#{mainBean.setUserQuery('Traes_2AS_C3EF3A27F')}">
                            <h:outputText value="example 1" />
                        </p:commandLink>
                        <p:spacer height="0" width="10" />
                        <p:commandLink update="idInput" actionListener="#{mainBean.setUserQuery('5BS_1598873')}">
                            <h:outputText value="example 2" />
                        </p:commandLink>
                    </f:facet>
                    <f:facet name="right">
                        <p:commandButton  value="Search" id="searchButton" actionListener="#{mainBean.searchAll}" icon="ui-icon-search" update="idInput,searchMessages,:formCentre:dataTable,:formCentre:chartsGrid,:formSearch3:contigList" 
                                          onstart="PF('blockUI').show()" oncomplete="PF('blockUI').hide();if(args.showContigList){PF('allContigsDialog').show()}"/>                        
                        <p:commandButton value="Clear" id="clearSearch" icon="ui-icon-cancel" update="idInput,searchMessages,:formCentre:dataTable,:formCentre:chartsGrid" process="@this" actionListener="#{mainBean.setUserQuery('')}" oncomplete="PF('dataTable').filter()"/>
                    </f:facet>
                </p:toolbar>
                <p:messages id="searchMessages" showDetail="true"  closable="true"  redisplay="false"  />
            </h:form>
        </p:dialog> 

        <!--        <h:form id="formUpload">
                    <p:overlayPanel widgetVar="uploadPanel" for=":formSearch2:tabView:uploadButton" hideEffect="fade"  hideEvent="mousedown" showEffect="scale" at="top"                            
                                    showCloseIcon="true" dismissable="true"   >
                    </p:overlayPanel>
                </h:form>          -->


        <p:dialog  id="searchSeqDialog" header="Search all chromosomes by aligning a sequence" widgetVar="searchSeqPanel" modal="false" position="80,140" minimizable="true" 
                   showEffect="scale" hideEffect="fade"  draggable="true" closable="true"  resizable="false" closeOnEscape="true" width="850" height="550" visible="#{mainBean.perQueryResults.hasResults()}">

            <h:form id="formSearch2">
                <!--                <p:blockUI id="blockBLAST" block="tabView" widgetVar="blockBLAST">
                                                    <p:graphicImage value="/images/ajax-loader#{randomBean.getRandom(13)}.gif" />
                                                    <br/>
                                                    <h:outputText value="BLASTn search running..."  style="font-size: larger"/>
                                                    <br/>
                                                    <h:outputText value="once finished, results will be displayed and will also become available at " />
                                                    <br/>
                                                    <h:outputText id="linkBLAST" value=" #{mainBean.blastn.getResultsLink('peru')}" escape="false"/>
                                                </p:blockUI>        -->
                <p:tabView id="tabView" activeIndex="#{mainBean.seqSearchTabActive}"    >
                    <p:tab title="Input"  >
                        <p:toolbar >
                            <f:facet name="left">
                                <!--<p:commandButton  id="uploadButton" value="Upload FASTA file..." icon="ui-icon-arrowreturnthick-1-s" onclick="PF('uploadPanel').show();" />--> 
                                <p:fileUpload widgetVar="fileUpload" fileUploadListener="#{mainBean.handleFileUpload}"  mode="advanced" auto="true" allowTypes="/(\.|\/)(fa|fasta|fas|txt|fst)$/" 
                                              label="Choose (or drag-and-drop) a FASTA file to upload" sizeLimit="2097152" invalidSizeMessage="The maximum file size allowed is 2MB!"                                               
                                              invalidFileMessage="Only upload FASTA files!" multiple="false"  update=":formSearch2:searchMessages2,:formSearch2:tabView:seqInput"/>                                
                                <h:outputText value="Load: " />
                                <p:commandLink update=":formSearch2:searchMessages2,:formSearch2:tabView:seqInput" actionListener="#{mainBean.loadExampleSequence}">
                                    <h:outputText value="example nucleotide sequence" />
                                </p:commandLink>
                                <h:outputText value=" or " />
                                <p:commandLink update=":formSearch2:searchMessages2,:formSearch2:tabView:seqInput" actionListener="#{mainBean.loadExampleFasta}">
                                    <h:outputText value="example FASTA input" />
                                </p:commandLink>

                            </f:facet>                                    
                            <f:facet name="right">
                                <p:commandButton  value="Search" id="searchSeqButton" actionListener="#{mainBean.sequenceSearchEventHandler}" icon="ui-icon-search" 
                                                  onstart="PF('blockBLAST').show();"                                                   
                                                  oncomplete="PF('blockBLAST').hide();"
                                                  update="seqInput,:formSearch2:searchMessages2,:formCentre:dataTable,tabView" />                        
                                <p:commandButton value="Clear" id="clearSeqSearch" icon="ui-icon-cancel" update="seqInput,:formSearch2:searchMessages2,:formCentre:dataTable,tabView" process="@this" actionListener="#{mainBean.clearFileContentString()}" oncomplete="PF('dataTable').filter();" />
                            </f:facet>
                        </p:toolbar>
                        <p:inputTextarea id="seqInput" widgetVar="seqInput" style="min-height: 250px;width: 98.5%;alignment-adjust: central; resize: none; font-family: monospace; font-size: larger" 
                                         autoResize="false" 
                                         placeholder="Enter a FASTA nucleotide sequence"  
                                         value="#{mainBean.fileContentString}" ondblclick="PF('uploadPanel').show()" />                            
                    </p:tab>
                    <p:tab title="Results - summary" disabled="#{!mainBean.hasHitsForQueryDataModel()}" >
                        <p:dataTable id="allresults" var="query" value="#{mainBean.hitsForQueryDataModel}" paginator="true" rows="5" rowsPerPageTemplate="5,10,15"   
                                     selection="#{mainBean.selectedQuery}"  selectionMode="single" paginatorAlwaysVisible="false" >  
                            <p:ajax event="rowSelect" update=":formSearch2:tabView"  />  
                            <f:facet name="header">  
                                Select a row to display hits retrieved for the corresponding query  
                            </f:facet>  

                            <p:column headerText="View" width="10%" >  
                                <p:commandButton id="selectButton" update=":formSearch2:tabView" icon="ui-icon-search" title="View">
                                    <f:setPropertyActionListener value="#{query}" target="#{mainBean.selectedQuery}" />
                                </p:commandButton>
                            </p:column>

                            <p:column headerText="Query ID" width="75%" >  
                                <!--<h:outputLabel value="#{query.getColoredQueryId()} " escape="false"/>-->
                                #{query.getFormatedQueryId()}
                            </p:column>  
                            <p:column headerText="Number of hits" width="15%" >  
                                <h:outputText value="#{query.getNumbPromotersA()}" escape="false"/>
                            </p:column>  
                        </p:dataTable>
                    </p:tab>
                    <p:tab title="Results - per query" disabled="#{!mainBean.hasHitsDataModel()}">
                        <h:panelGrid columns="2" cellpadding="4">  
                        </h:panelGrid>  

                        <p:dataTable var="hit" value="#{mainBean.hitsDataModel}" paginator="true" rows="5"  selectionMode="single"
                                     selection="#{mainBean.selectedHit}" paginatorAlwaysVisible="false" >  
                            <f:facet name="header">  
                                <h:outputText value="#{mainBean.selectedQuery.getNumbPromotersB()} hits retrieved for the selected query : #{mainBean.selectedQuery.queryId}" escape="false"/>
                            </f:facet>  
                            <p:ajax event="rowSelect" onstart="PF('blockUI').show();" oncomplete="PF('blockUI').hide();if(args.showContigList){PF('allContigsDialog').show()}"  
                                    update=":formCentre:dataTable,:formSearch:idInput,:formSearch2:searchMessages2,:formCentre:chartsGrid,:formSearch3:contigList" />
                            <p:column style="width:7%" >
                                <p:commandButton id="selectButton3" icon="ui-icon-search" update=":formCentre:dataTable,:formSearch:idInput,:formSearch2:searchMessages2,:formCentre:chartsGrid,:formSearch3:contigList" 
                                                 onstart="PF('blockUI').show()" oncomplete="PF('blockUI').hide();if(args.showContigList){PF('allContigsDialog').show()}">
                                    <f:setPropertyActionListener value="#{hit}" target="#{mainBean.selectedHit}" />
                                </p:commandButton>                            
                            </p:column>

                            <p:column headerText="Hit contig ID" style="width:14%; text-align: center">  
                                #{hit.hitId}  
                            </p:column>  
                            <p:column headerText="Coordinates" style="width:18%; text-align: center">  
                                <h:outputText value=" #{hit.getContigCoordinatesHTML()}" escape="false"/>
                            </p:column>  
                            <p:column headerText="orientation" style="width:10%; text-align: center">  
                                #{hit.getFrames()}  
                            </p:column>  
                            <p:column headerText="full query identity" style="width:15%; text-align: center">  
                                <h:outputText value="#{hit.getPercIdOverQlen()}" escape="false" />
                            </p:column>  
                            <p:column headerText="aligned query identity" style="width:15%; text-align: center">  
                                <h:outputText value="#{hit.getPercIdOverAlignedQlen()}" escape="false" />
                            </p:column>  
                            <p:column headerText="query aligned" style="width:15%; text-align: center">  
                                <h:outputText value="#{hit.getPercQueryAligned()}" escape="false"/>
                            </p:column>  

                        </p:dataTable>  
                    </p:tab>
                </p:tabView>
                <p:messages id="searchMessages2" showDetail="true"  closable="true" redisplay="false"  escape="false"    />
            </h:form>
        </p:dialog> 



        <p:dialog  id="allContigsDialog" header="All contigs within a cM range..." widgetVar="allContigsDialog" modal="false" minimizable="true"  
                   showEffect="scale" hideEffect="fade"  draggable="true" closable="true"  resizable="false" closeOnEscape="true" width="850" height="550">

            <h:form id="formSearch3">
                <p:spacer height="10" width="0" />

                <p:dataTable id="contigList" widgetVar="contigList" value="#{mainBean.perLocationContigs.contigs}" var="contig" style="text-align: center" 
                             selection="#{mainBean.perLocationContigs.selectedContigs}" rowKey="#{contig.id}"  
                             rowStyleClass="#{mainBean.contains(mainBean.userQuery, contig.contigId) ? 'highlighted' : null}" 
                             paginator="true" rows="10" paginatorAlwaysVisible="true"  styleClass="paginated"
                             paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}">
                    <f:facet name="header">
                        <p:toolbar>
                            <f:facet name="left">
                                <h:outputText value="List contigs on chromosome " />
                                <p:autoComplete dropdown="true" value="#{mainBean.chromosomeForNonGeneContigs}" completeMethod="#{trivialBean.getChromosomes()}"  
                                                forceSelection="true" size="2" >
                                    <p:ajax event="itemSelect" listener="#{mainBean.loadAllContigs()}" update=":formSearch3:contigList" 
                                            process="@this" onstart="PF('blockContigList').show();" oncomplete="PF('contigList').filter();" />
                                </p:autoComplete> 
                                <p:spacer height="0" width="10" />
                                <h:outputText value="between " />                                
                                <p:autoComplete dropdown="true" value="#{mainBean.perLocationContigs.cM_filterForNonGeneContigs.cM_min_user}" 
                                                completeMethod="#{mainBean.perLocationContigs.rangePrefix}" 
                                                disabled="#{!mainBean.perLocationContigs.dataLoaded}"
                                                forceSelection="true" size="7" scrollHeight="400" immediate="true"  >
                                    <p:ajax event="itemSelect" update=":formSearch3:contigList" process="@this"  
                                            oncomplete="PF('contigList').filter();" />
                                </p:autoComplete>
                                <p:spacer height="0" width="10" />
                                <h:outputText value=" and  " />
                                <p:autoComplete dropdown="true" value="#{mainBean.perLocationContigs.cM_filterForNonGeneContigs.cM_max_user}" 
                                                completeMethod="#{mainBean.perLocationContigs.rangePrefix}" 
                                                disabled="#{!mainBean.perLocationContigs.dataLoaded}"
                                                forceSelection="true" size="7" scrollHeight="400" immediate="true">                                    
                                    <p:ajax event="itemSelect" update=":formSearch3:contigList" process="@this"  
                                            oncomplete="PF('contigList').filter();" />
                                </p:autoComplete>
                                <p:spacer height="0" width="5" />
                                <h:outputText value=" cM" />
                            </f:facet>
                            <f:facet name="right">
                                <p:commandButton title="Reset cM filtering" value="Reset cM filtering" icon="ui-icon-cancel" update=":formSearch3:contigList" 
                                                 process="@this" action="#{mainBean.perLocationContigs.resetFilter()}" 
                                                 oncomplete="PF('contigList').filter();" 
                                                 disabled="#{!mainBean.perLocationContigs.isFiltered()}" />
                            </f:facet>
                        </p:toolbar>
                        <p:blockUI block="contigList" widgetVar="blockContigList" />        
                    </f:facet>
                    <p:column selectionMode="multiple" style="width:16px;text-align:center"/>
                    <p:column headerText="Contig ID"  >                        
                        <h:outputText value="#{contig.contigId}" />                        
                    </p:column>                     
                    <p:column headerText="cM" filterBy="#{contig.cM}" filterFunction="#{mainBean.perLocationContigs.filterByCm}">
                        <f:facet name="filter">
                            <h:inputHidden id="cM_range" value="#{mainBean.perLocationContigs.cM_filterForNonGeneContigs.cM_range_user}" />
                        </f:facet>
                        <h:outputText value="#{contig.cM}" />                        
                    </p:column>                     
<!--                    <p:column headerText="cM (min)" filterBy="#{contig.cM}" filterMatchMode="gte">
                        <f:facet name="filter">
                            <p:autoComplete dropdown="true" value="#{mainBean.perLocationContigs.cM_filterForNonGeneContigs.cM_min_user}" 
                                            completeMethod="#{mainBean.perLocationContigs.rangePrefix}" 
                                            forceSelection="true" size="7" scrollHeight="400"  >
                                <p:ajax event="itemSelect" process="@this" update=":formSearch3:contigList"
                                        oncomplete="PF('contigList').filter()" />                                        
                                <f:converter converterId="javax.faces.Double" />
                            </p:autoComplete>
                        </f:facet>
                        <h:outputText value="#{contig.cM}" />                        
                    </p:column>                     -->
<!--                    <p:column headerText="cM (max)" filterBy="#{contig.cM}" filterMatchMode="lte" >     
                        <f:facet name="filter" >
                            <p:autoComplete dropdown="true" value="#{mainBean.perLocationContigs.cM_filterForNonGeneContigs.cM_max_user}" 
                                            completeMethod="#{mainBean.perLocationContigs.rangePrefix}" 
                                            forceSelection="true" size="7" scrollHeight="400"  >
                                <p:ajax event="itemSelect" process="@this" update=":formSearch3:contigList"
                                        oncomplete="PF('contigList').filter()" />
                                <f:converter converterId="javax.faces.Double" />
                            </p:autoComplete>
                        </f:facet>
                        <h:outputText value="#{contig.cM}" />                        
                    </p:column>                     -->
                    <p:ajax event="filter" process="@this" onstart="PF('blockContigList').show();" oncomplete="PF('blockContigList').hide();"/>  
                    <p:ajax event="rowSelect" update="contigExportToolbar" process="@this"/>  
                    <p:ajax event="rowUnselect" update="contigExportToolbar" process="@this"/>
                    <p:ajax event="toggleSelect" update="contigExportToolbar" process="@this"/>
                    <p:ajax event="rowSelectCheckbox" update="contigExportToolbar" process="@this"/>
                    <p:ajax event="rowUnselectCheckbox" update="contigExportToolbar" process="@this"/>
                    <f:facet name="footer">
                        <p:toolbar id="contigExportToolbar"  >
                            <f:facet name="left">
                                <p:commandButton value="Clear selection"  icon="ui-icon-cancel" action="#{mainBean.perLocationContigs.clearSelectedContigs()}" onstart="PF('blockContigList').show();"   
                                                 oncomplete="PF('blockContigList').hide();" title="Clear record selection" disabled="#{!mainBean.perLocationContigs.somethingSelected()}" 
                                                 update=":formSearch3:contigList" >                            
                                </p:commandButton> 
                                <p:spacer width="15" height="1" />
                                <p:commandButton value="Save selected contig(s)"  icon="ui-icon-disk"  onclick="PF('statusDialog').show();"   
                                                 title="Save the selected IWGSC contig(s) to a FASTA file" disabled="#{!mainBean.perLocationContigs.somethingSelected()}" ajax="false" >                            
                                    <p:fileDownload value="#{mainBean.perLocationContigs.exportFileWholeIWGSC}"     />                                         
                                </p:commandButton>
                            </f:facet>

                            <f:facet name="right">

                                <h:outputLabel value="Download " escape="false" style="vertical-align: middle;" />
                                <p:selectOneMenu value="#{mainBean.perLocationContigs.toExport}" style="vertical-align: middle; text-align: left; width: 120px" disabled="#{!mainBean.perLocationContigs.dataLoaded}"   >
                                    <f:selectItem itemLabel="current page" itemValue="page" />
                                    <f:selectItem itemLabel="whole table" itemValue="all"/>
                                    <p:ajax update="exportCSV"/>  
                                </p:selectOneMenu>
                                <h:outputLabel value=" as " escape="false" style="vertical-align: middle;" />
                                <!--                                    <f:selectItem itemLabel="selected rows" itemValue="selected" />-->
                                <h:commandLink id="exportCSV" disabled="#{mainBean.perLocationContigs.exportDsiabled()}" onclick="PF('statusDialog').show();">
                                    <p:graphicImage value="/images/csv.png" style="vertical-align: middle;" title="Export table to a CSV file." rendered="#{!mainBean.perLocationContigs.exportDsiabled()}"/>
                                    <p:graphicImage value="/images/csv_grey.png" style="vertical-align: middle;" title="Export table to a CSV file." rendered="#{mainBean.perLocationContigs.exportDsiabled()}"/>
                                    <p:dataExporter type="csv" target="contigList" fileName="Contigs_table_#{randomBean.getRandomFilename()}" pageOnly="#{mainBean.perLocationContigs.exportPageOnly()}" 
                                                    selectionOnly="#{mainBean.perLocationContigs.exportSelectedOnly()}"/>
                                </h:commandLink>
                            </f:facet>
                        </p:toolbar>
                    </f:facet>
                </p:dataTable>
            </h:form>

        </p:dialog>



<!--<p:slideMenu model="#{mainBean.menuModel}" style="width: 110pt" />-->
        <!--<p:commandButton type="button" onclick="jQuery('.ui-row-toggler').click()" value="Expand/collapse gene annotation"  />-->

        <!--        <p:dialog widgetVar="helpDialog1" modal="false" showEffect="puff" hideEffect="clip" resizable="true"  closeOnEscape="true" header="CoChing help"  >  
                                <p:graphicImage value="/images/CoChing_help1.png" /> 
                            </p:dialog> -->
        <p:dialog widgetVar="helpDialogForMainTable" modal="false" 
                  showEffect="slide" hideEffect="drop" resizable="true" closeOnEscape="true" header="POTAGE help: main table explained" >  
            blah
            <!--                        <p:tabView id="tabView" effect="fade" >
                                        <p:tab id="tab1" title="The output table (1/3)">
                                            <p:graphicImage value="/images/CoChing_help2.png" /> 
                                        </p:tab>
                                        <p:tab id="tab2" title="The output table (2/3)">
                                            <p:graphicImage value="/images/CoChing_help3.png" /> 
                                        </p:tab>
                                        <p:tab id="tab3" title="The output table (3/3)">
                                            <p:graphicImage value="/images/CoChing_help4.png" /> 
                                        </p:tab>
                                    </p:tabView>-->
        </p:dialog> 

        <h:form id="formCentre" >


            <p:dataTable var="gene" value="#{mainBean.loadedGenes}" styleClass="myTable"
                         selection="#{mainBean.selectedGenes}"  
                         id="dataTable" widgetVar="dataTable" 
                         rowKey="#{gene.geneId}" 
                         paginator="true" rows="10" paginatorAlwaysVisible="true" rowsPerPageTemplate="5,10,20,40,80,160" style="text-align: center"
                         paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                         rowStyleClass="#{mainBean.contains(mainBean.userQuery, gene.geneId, gene.contig.contigId) ? 'highlighted' : null}" 
                         reflow="true" >
                <p:ajax event="page" onstart="PF('block2Table').show();" oncomplete="PF('block2Table').hide();" process="@this" update="@this"   />    
                <f:facet name="header" >
                    <p:toolbar>
                        <f:facet name="left">
                            <!--                            <p:commandButton icon="ui-icon ui-icon-info blueIcon" value="Click here for more information about this table" 
                                                                         onclick="PF('helpDialogForMainTable').initPosition();PF('helpDialogForMainTable').show();" type="button"/>-->

                            <h:outputText value="Main output table"  />
                            <p:spacer height="0" width="35" />
                            <h:outputText value="#{mainBean.currentChromosome}"  />
                        </f:facet>
                        <f:facet name="right">
                            <h:outputText value="Filter current chromosome by text field: " />
                            <p:inputText id="globalFilter" widgetVar="globalFilter" onkeyup="PF('dataTable').filter()" style="width:150px; color: #fd3506" 
                                         placeholder="Enter keyword" value="#{mainBean.globalFilter}" onfocus="PF('dataTable').filter()"   />
                            <p:commandButton id="filterbutton" icon="ui-icon-check" update="dataTable,:formCentre:chartsGrid"  onclick="PF('dataTable').filter()" />
                            <p:commandButton id="clearbutton" icon="ui-icon-cancel" update="dataTable,:formCentre:chartsGrid" process="@this" action="#{mainBean.setGlobalFilter('')}" 
                                             onstart="PF('blockUI').show();" oncomplete="PF('blockUI').hide();PF('dataTable').filter()"/>                                  
                        </f:facet>
                    </p:toolbar>
                    <p:toolbar>
                        <f:facet name="left" >
                            <h:outputText value="Filter by POPSEQ bin (cM): " />
                            <p:autoComplete dropdown="true" value="#{mainBean.cM_filter.cM_min_user}"   disabled="#{!mainBean.dataLoaded}" 
                                            forceSelection="true" size="7" scrollHeight="400" title="Type in the desired cM position (from)"   
                                            completeMethod="#{mainBean.cM_filter.rangePrefix}" >
                                <p:ajax event="itemSelect" update="dataTable" process="@this"  
                                        onstart="PF('blockUI').show();" 
                                        oncomplete="PF('dataTable').filter();PF('blockUI').hide();" />
                            </p:autoComplete>
                            <h:outputText value=" to " />
                            <p:autoComplete dropdown="true" value="#{mainBean.cM_filter.cM_max_user}"   disabled="#{!mainBean.dataLoaded}"
                                            forceSelection="true" size="7"   scrollHeight="400" title="Type in the desired cM position (to)"  
                                            completeMethod="#{mainBean.cM_filter.rangePrefix}" >
                                <p:ajax event="itemSelect" update="dataTable" process="@this"  
                                        onstart="PF('blockUI').show();" 
                                        oncomplete="PF('dataTable').filter();PF('blockUI').hide();" />
                            <!--<p:ajax event="itemSelect" update="dataTable" process="@this" listener="#{mainBean.filterByCm}" onstart="PF('blockUI').show();" oncomplete="PF('blockUI').hide();" />-->
                            <!--<p:ajax event="change" update="dataTable" process="@this" listener="#{mainBean.filterByCm}" onstart="PF('blockUI').show();" oncomplete="PF('blockUI').hide();" />-->
                            </p:autoComplete>
                            <!--<p:spacer height="0" width="75" />-->
                            <!--                            <h:outputText value="cM (original) between " />
                                                        <p:autoComplete dropdown="true" value="#{mainBean.cM_filter.cM_original_min_user}"   disabled="#{!mainBean.dataLoaded}" 
                                                                        forceSelection="true" size="7" scrollHeight="400" title="Type in the desired cM (original) position (from)"   
                                                                        completeMethod="#{mainBean.cM_filter.originalRangePrefix}" >
                                                            <p:ajax event="itemSelect" update="dataTable" process="@this" listener="#{mainBean.filterByCm()}" onstart="PF('blockUI').show();" oncomplete="PF('blockUI').hide();" />
                                                        </p:autoComplete>
                                                        <p:spacer height="0" width="35" />
                                                        <h:outputText value=" and   " />
                                                        <p:autoComplete dropdown="true" value="#{mainBean.cM_filter.cM_original_max_user}"   disabled="#{!mainBean.dataLoaded}"
                                                                        forceSelection="true" size="7"   scrollHeight="400" title="Type in the desired cM (original) position (to)"  
                                                                        completeMethod="#{mainBean.cM_filter.originalRangePrefix}" >
                                                            <p:ajax event="itemSelect" update="dataTable" process="@this" listener="#{mainBean.filterByCm()}" onstart="PF('blockUI').show();" oncomplete="PF('blockUI').hide();" />
                                                        </p:autoComplete>-->
                            <p:spacer height="0" width="35" />
                            <p:commandButton value="Reset cM filter"  icon="ui-icon-cancel" update=":formCentre:dataTable" process="@this" action="#{mainBean.resetFilter()}" 
                                             onstart="PF('blockTable').show();" oncomplete="PF('dataTable').filter();PF('blockTable').hide();" disabled="#{!mainBean.cM_filter.isFiltered()}" />

                        </f:facet>
                        <f:facet name="right">
                            <h:outputText value="Include genes on unanchored contigs? " title="Added to bottom of the table" />
                            <p:selectBooleanButton value="#{mainBean.appendUnordered}" onLabel="Yes" offLabel="No" onIcon="ui-icon-check" 
                                                   offIcon="ui-icon-close" style="width:60px" >
                                <p:ajax update="dataTable" listener="#{mainBean.reload()}"   process="@this"
                                        onstart="PF('blockUI').show();" oncomplete="PF('dataTable').filter();PF('blockUI').hide();"/>
                            </p:selectBooleanButton>
                        </f:facet>
                    </p:toolbar>

                </f:facet>
                <p:columnGroup type="header" id="headerGroup" >   
                    <p:row > 
                        <p:column rowspan="2" selectionMode="multiple" width="25"  />
                        <p:column rowspan="2" headerText="Expression" width="135"/>  
                        <p:column rowspan="2" headerText="Gene ID"  filterBy="#{gene.geneId}"  filterFunction="#{mainBean.filterIgnoreCaseContains}" width="140"/>
                        <p:column rowspan="2" headerText="From"   width="30"/>
                        <p:column rowspan="2" headerText="To"   width="30"/>
                        <p:column rowspan="2" headerText="+/-"  width="10" id="strand" /> 
                        <p:column rowspan="2" headerText="Contig ID" filterBy="#{gene.contig.contigId}" filterFunction="#{mainBean.filterIgnoreCaseContains}" width="105"/>
                        <p:column rowspan="2" headerText="cM" style="text-align: center"   width="47" 
                                  filterBy="#{gene.contig.cM}"
                                  filterFunction="#{mainBean.cM_filter.filterByCm}" >
                            <f:facet name="filter">
                                <h:inputHidden id="cM_range" value="#{mainBean.cM_filter.cM_range_user}" />
                            </f:facet>                    
                        </p:column>

                        <!--<p:column rowspan="2" headerText="cM original" style="text-align: center" width="45" />-->
                        <p:column colspan="3"  headerText="MIPS Annotation" style="color: peru" />
                        <p:column colspan="2" headerText="Rice-derived Annotation"  style="color: mediumseagreen"/>
                    </p:row>
                    <p:row>
                        <p:column headerText="Hit ID" style="color: peru"  width="120" filterBy="#{gene.annotationMips.hitId}" filterFunction="#{mainBean.filterIgnoreCaseContains}"/>
                        <p:column headerText="Description" style="color: peru" filterBy="#{gene.annotationMips.annotationString}" filterFunction="#{mainBean.filterIgnoreCaseContains}"/>                                        
                        <p:column headerText="InterproID" style="color: peru; wrapClass1" filterBy="#{gene.annotationMips.interpro}" filterFunction="#{mainBean.filterIgnoreCaseContains}"/>
                        <p:column headerText="Hit ID" style="color: mediumseagreen" filterBy="#{gene.annotationRice.hitId}" filterFunction="#{mainBean.filterIgnoreCaseContains}"/>
                        <p:column headerText="Description" style="color: mediumseagreen" filterBy="#{gene.annotationRice.annotationString}" filterFunction="#{mainBean.filterIgnoreCaseContains}"/>
                    </p:row>
                </p:columnGroup>

                <p:column selectionMode="multiple" width="25" exportable="false" />

                <p:column exportable="false">  
                    <p:blockUI block="dataTable" widgetVar="blockTable"   />
                    <p:commandButton icon="ui-icon-newwin" id="view" value="View" onstart="PF('blockTable').show();" oncomplete="PF('blockTable').hide()"  
                                     action="#{mainBean.setGeneSelectedForDialogDisplay(gene)}"/>
                    <p:commandButton icon="ui-icon-arrowthickstop-1-s" title="Add gene to expression charts display" onstart="PF('blockUI').show();" oncomplete="PF('blockUI').hide()" 
                                     action="#{mainBean.addGeneToDisplay(gene)}" update=":formCentre:chartsGrid"  />

                    <p:button icon="ui-icon-extlink" target="_blank" 
                              href="http://wheat.pw.usda.gov/WheatExp/graph_and_table.php?seq_id=#{gene.geneId}.1" 
                              title="View gene expression on http://wheat.pw.usda.gov/WheatExp/" />

                </p:column>
                <p:column> <h:outputText value="#{gene.getGeneIdHTML('peru','http://archive.plants.ensembl.org/Triticum_aestivum/Gene/Summary?g=')}" escape="false"/></p:column>
                <p:column> <h:outputText value="#{gene.from}"/></p:column>
                <p:column> <h:outputText value="#{gene.to}"/></p:column>
                <p:column> <h:outputText value="#{gene.strand}"/></p:column>
                <p:column> <h:outputText value="#{gene.contig.contigId}"  />  </p:column>
                <p:column> <h:outputText value="#{gene.contig.cM}  " /> </p:column>
                <p:column> <h:outputText value="#{gene.annotationMips.getMipsHTML('peru')}" escape="false"/> </p:column> 
                <p:column> <h:outputText value="#{gene.annotationMips.annotationString}" style="color: peru" /> </p:column>  
                <p:column> 
                    <h:outputText value="#{gene.annotationMips.getInterproHTML('peru')}"  escape="false"/>  
                </p:column>  
                <p:column> <h:outputText value="#{gene.annotationRice.getRiceHTML('mediumseagreen')}" escape="fasle" /> </p:column> 
                <p:column> <h:outputText value="#{gene.annotationRice.annotationString}" style="color: mediumseagreen"/> </p:column>  

                <p:ajax event="rowSelect" update="exportToolbar,:formCentre:chartsGrid" process="@this,:formCentre:chartsGrid" />  
                <p:ajax event="rowUnselect" update="exportToolbar,:formCentre:chartsGrid" process="@this,:formCentre:chartsGrid"/>
                <p:ajax event="toggleSelect" update="exportToolbar,:formCentre:chartsGrid" process="@this,:formCentre:chartsGrid"/>
                <p:ajax event="rowSelectCheckbox" update="exportToolbar,:formCentre:chartsGrid" process="@this,:formCentre:chartsGrid"/>
                <p:ajax event="rowUnselectCheckbox" update="exportToolbar,:formCentre:chartsGrid" process="@this,:formCentre:chartsGrid"/>

                <f:facet name="footer"  > 
                    <p:toolbar id="exportToolbar"  >
                        <f:facet name="left">
                            <p:blockUI block="dataTable" widgetVar="block2Table"    />
                            <h:outputLabel value="Process selection: " escape="false" style="vertical-align: middle;" />
                            <p:commandButton value="Add to charts display"  icon="ui-icon-arrowthickstop-1-s" action="#{mainBean.addSelectedGenesToDisplay()}" 
                                             onstart="PF('blockUI').show();"   
                                             oncomplete="PF('blockUI').hide();" title="Add selection to charts display" disabled="#{!mainBean.somethingSelected()}" 
                                             update=":formCentre:chartsGrid" >                            
                            </p:commandButton> 


                            <p:spacer width="15" height="1" />
                            <p:commandButton value="Clear"  icon="ui-icon-cancel" action="#{mainBean.clearSelectedGenes()}" onstart="PF('block2Table').show();"   
                                             oncomplete="PF('block2Table').hide();" title="Clear record selection" disabled="#{!mainBean.somethingSelected()}" 
                                             update="dataTable,:formCentre:chartsGrid" >                            
                            </p:commandButton> 
                            <p:spacer width="15" height="1" />
                            <p:commandButton value="Download contig(s)"  icon="ui-icon-disk" onclick="PrimeFaces.monitorDownload(start, stop);"   
                                             title="Download IWGSC contig(s) in FASTA format" disabled="#{!mainBean.somethingSelected()}" ajax="false" >                            
                                <p:fileDownload value="#{mainBean.exportFileWholeIWGSC}"    />                                
                            </p:commandButton> 
                        </f:facet>
                        <f:facet name="right"> 
                            <h:outputLabel value="Download " escape="false" style="vertical-align: middle;" />
                            <p:selectOneMenu value="#{mainBean.toExport}" style="vertical-align: middle; text-align: left; width: 120px" disabled="#{!mainBean.dataLoaded}"   >
                                <f:selectItem itemLabel="current page" itemValue="page" />
                                <f:selectItem itemLabel="selected rows" itemValue="selected" />
                                <f:selectItem itemLabel="whole table" itemValue="all"/>
                                <p:ajax update="exportXLS"/>  
                            </p:selectOneMenu>
                            <h:outputLabel value=" as " escape="false" style="vertical-align: middle;" />
                            <h:commandLink id="exportXLS" disabled="#{mainBean.exportDsiabled()}" onclick="PF('statusDialog').show();">
                                <p:graphicImage value="/images/xls1.png" style="vertical-align: middle;" title="Export to xls format" rendered="#{!mainBean.exportDsiabled()}"/>
                                <p:graphicImage value="/images/xls1grey.png" style="vertical-align: middle;" title="Export to xls format" rendered="#{mainBean.exportDsiabled()}"/>
                                <p:dataExporter type="xls" target="dataTable" fileName="POTAGE_table_#{randomBean.getRandomFilename()}" pageOnly="#{mainBean.exportPageOnly()}"  
                                                selectionOnly="#{mainBean.exportSelectedOnly()}" postProcessor="#{mainBean.postProcessXLS}" /> 
                            </h:commandLink>
                        </f:facet>
                    </p:toolbar>
                </f:facet>
            </p:dataTable>


            <p:confirmDialog  widgetVar="statusDialog" closable="true" severity="info" message="Download initiated, a file will become available shortly."  style="alignment-adjust: middle"  >                    
                <p:commandButton value="OK" style="width: 100%" type="button" icon="ui-icon-check" onclick="PF('statusDialog').hide()"/> 
            </p:confirmDialog>  


            <p:spacer height="20" />

            <p:dataGrid var="gene" value="#{mainBean.selectedGenesForChartDisplay}" columns="3" rows="6" paginator="true" id="chartsGrid" widgetVar="chartsGrid"
                        emptyMessage="No genes selected for display." 
                        paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                        rowsPerPageTemplate="3,6,9,12" >
                <p:ajax event="page" onstart="PF('blockUI').show();" oncomplete="PF('blockUI').hide();" />   

                <f:facet name="header" >
                    <p:toolbar>
                        <f:facet name="left">
                            <h:outputText value="Expression charts display"  />
                        </f:facet>
                        <f:facet name="right">
                            <p:commandButton id="clearCharts" widgetVar="clearCharts" title="Remove all charts from display"  icon="ui-icon-trash" action="#{mainBean.clearSelectedGenesForChartDisplay()}" 
                                             onstart="PF('blockUI').show();"   oncomplete="PF('blockUI').hide();" 
                                             disabled="#{mainBean.hasNoGenesSelectedForDisplay()}" update=":formCentre:chartsGrid"/> 
                        </f:facet>
                    </p:toolbar>
                </f:facet>
                <p:panel style="text-align:center;"   >
                    <f:facet name="header">
                        <p:commandLink actionListener="#{mainBean.searchAllInternal(gene.geneId)}" 
                                       update=":formCentre:dataTable" style="text-align:center"
                                          onstart="PF('blockUI').show()" oncomplete="PF('blockUI').hide();">                            
                            <h:outputText value="#{gene.geneId}  on  #{gene.contig.contigId}" />
                        </p:commandLink>
                    </f:facet>
                    <p:tabView id="chartsTabView" value="#{gene.barChartModels}" var="chartModel"  >
                        <p:ajax event="tabChange" update="chartsTabView" listener="#{gene.onTabChange}"/>
                        <p:tab title="#{chartModel.getShortTitle()}">
                            <p:chart type="bar" model="#{chartModel}"  widgetVar="#{chartModel.chartId}"   />
                        </p:tab>
                    </p:tabView>

                    <!--                    <p:tabView id="chartsTabView" >
                                            <p:ajax event="tabChange" update="chartsTabView" listener="#{gene.onTabChange}"/>
                                            <p:tab title="Chinese Spring">
                                                <p:chart type="bar" model="#{gene.getBarChartModel(0)}" widgetVar="chart_0_#{gene.geneId}"   >
                                                    <p:ajax event="itemSelect" listener="#{mainBean.chartItemSelect}"/>
                                                </p:chart>                            
                                            </p:tab>
                                            <p:tab title="Cultivar X">
                                            <p:tab title="Chris">
                                                <p:chart type="bar" model="#{gene.getBarChartModel(1)}" widgetVar="chart_1_#{gene.geneId}"  />
                                            </p:tab>
                                            <p:tab title="Cultivar Y">
                                            <p:tab title="Cornerstone/CS">
                                                <p:chart type="bar" model="#{gene.getBarChartModel(2)}" widgetVar="chart_2_#{gene.geneId}"  />
                                            </p:tab>
                                            <p:tab title="Excalibur">
                                                <p:chart type="bar" model="#{gene.getBarChartModel(3)}" widgetVar="chart_3_#{gene.geneId}"  />
                                            </p:tab>
                                            <p:tab title="RAC875">
                                                <p:chart type="bar" model="#{gene.getBarChartModel(4)}" widgetVar="chart_4_#{gene.geneId}"  />
                                            </p:tab>
                                        </p:tabView>-->
                    <f:facet name="actions" >
                        <p:commandButton icon="ui-icon-trash" action="#{mainBean.removeFromChartDisplay(gene)}" onstart="PF('blockUI').show();"   
                                         oncomplete="PF('blockUI').hide();" title="Remove chart" process=":formCentre:chartsGrid" 
                                         update=":formCentre:chartsGrid" styleClass="ui-panel-titlebar-icon ui-corner-all ui-state-default"/>   
                        <p:commandButton icon="ui-icon-image" action="#{gene.exportChart(gene)}"    
                                         oncomplete="exportChart(xhr, status, args);" title="Download chart as image"  
                                         styleClass="ui-panel-titlebar-icon ui-corner-all ui-state-default"/>   
                    </f:facet>
                </p:panel>

            </p:dataGrid>





            <p:chart  type="bar"  rendered="false"/> 
            <h:outputLabel  value="#{mainBean.generateDialogContainers()}"/>



            <p:remoteCommand name="updatechartsgrid"  update=":formCentre:chartsGrid" action="#{randomBean.getRandom(1)}" process=":formCentre:chartsGrid" />
<!--            <p:remoteCommand name="updatehelpdialog"  update=":helpForm:helpDialog" action="#{randomBean.getRandom(1)}" process=":helpForm:helpDialog" 
                             onstart="PF('helpDialog').hide();" oncomplete="PF('helpDialog').show();"/>-->
            <!--<p:remoteCommand name="onload" action="#{mainBean.init()}"  oncomplete="filterTable(xhr, status, args);" autoRun="true"   />-->
        </h:form>


        <p:dialog widgetVar="exportChart" showEffect="fade" modal="true" header="Right-click on the chart to copy/save it as image." resizable="false"  >
            <p:outputPanel id="outputChart" layout="block"/>
        </p:dialog>

        <p:spacer />
        <div class="footer">
            <h:panelGroup rendered="#{not empty mainBean.appData.potageCommitId and not empty mainBean.appData.potageDataCommitId}">
                This server is running: POTAGE code commit ID (<a href="https://github.com/CroBiA/potage/tree/#{mainBean.appData.potageCommitId}">#{mainBean.appData.potageCommitId}</a>) with POTAGE data commit ID (<a href="https://github.com/CroBiA/potage_data/tree/#{mainBean.appData.potageDataCommitId}">#{mainBean.appData.potageDataCommitId}</a>)
                <br />
            </h:panelGroup>
            <!--©&nbsp;Copyright&nbsp;2014-2016&nbsp;<a href="http://www.acpfg.com.au/">Australian&nbsp;Centre&nbsp;for&nbsp;Plant&nbsp;Functional&nbsp;Genomics</a>-->
        </div>

    </body>

    <a href="https://github.com/CroBiAd/potage" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <script type="text/javascript">
        window.onresize = function (event) {
            updatechartsgrid();
//            updatehelpdialog();
        }
    </script>

    <script type="text/javascript">
        function exportChart(xhr, status, args) {
            var gene = args.exportChart;
//            alert(gene);            
            //export image
//            $('#outputChart').empty().append(PF('Traes_3DS_310A77808' ).exportAsImage());
            $('#outputChart').empty().append(PF(gene).exportAsImage());
            //show the dialog
            PF('exportChart').show();
        }
    </script>
    <script  type="text/javascript" >
        $j = jQuery;
        $j(document).ready(function () {
            if (#{mainBean.initFilterTable}) {
                PF('block2Table').show();
                PF('dataTable').filter();
                PF('block2Table').hide();
            }
        });
    </script>  
    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                    m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-84940540-2', 'auto');
        ga('send', 'pageview');

    </script>
</f:view>
</html>

